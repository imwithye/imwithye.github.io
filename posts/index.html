<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | 禅心剑气相思骨</title>
<meta name=keywords content><meta name=description content="Posts - 禅心剑气相思骨"><meta name=author content="Yiwei Gong"><link rel=canonical href=https://yiwei.dev/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://yiwei.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yiwei.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yiwei.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://yiwei.dev/apple-touch-icon.png><link rel=mask-icon href=https://yiwei.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://yiwei.dev/posts/index.xml><link rel=alternate hreflang=en href=https://yiwei.dev/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-chtml.js></script><meta property="og:url" content="https://yiwei.dev/posts/"><meta property="og:site_name" content="禅心剑气相思骨"><meta property="og:title" content="Posts"><meta property="og:description" content="Yiwei Gong's Blog"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="Yiwei Gong's Blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yiwei.dev/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yiwei.dev/ accesskey=h title="禅心剑气相思骨 (Alt + H)">禅心剑气相思骨</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yiwei.dev/ title=Home><span>Home</span></a></li><li><a href=https://yiwei.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://yiwei.dev/archives title=Archives><span>Archives</span></a></li><li><a href=https://yiwei.dev/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Deploy Self-hosted GitHub Actions Runner with ArgoCD and Akuity Platform</h2></header><div class=entry-content><p>GitHub Actions simplifies CI/CD but can become costly with GitHub-hosted runners. Self-hosted runners offer better cost control and customization.
This post covers deploying a self-hosted runner using ArgoCD and the Akuity Platform.
Why ArgoCD and Akuity Platform? ArgoCD ensures Kubernetes clusters align with Git-defined states, simplifying management and improving consistency. While ArgoCD is powerful, the Akuity Platform enhances it with added security, usability, and its KubeVision tool for efficient Kubernetes resource visualization and troubleshooting.
...</p></div><footer class=entry-footer><span title='2024-12-25 15:00:00 +0800 +0800'>December 25, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;713 words&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to Deploy Self-hosted GitHub Actions Runner with ArgoCD and Akuity Platform" href=https://yiwei.dev/posts/arc-akuity/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>K3s Cloud Master and Local Agent Setup</h2></header><div class=entry-content><p>Setting up a cloud-based k3s master node with local agent nodes allows for easy management of distributed infrastructure. This setup is ideal for scenarios such as integrating a local GPU cluster or managing edge devices like vending machines, ensuring stable network connectivity without the need for additional software.
Use Cases Local GPU Cluster: You can add your local GPU cluster as a worker node to the cloud k3s master, enabling centralized scheduling of complex tasks without worrying about network issues.
...</p></div><footer class=entry-footer><span title='2024-09-30 00:00:00 +0000 UTC'>September 30, 2024</span>&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to K3s Cloud Master and Local Agent Setup" href=https://yiwei.dev/posts/k3s-nat/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Transitioning from GitFlow to GitHub PR Workflow: A Journey in Streamlining Our Development Process</h2></header><div class=entry-content><p>Transitioning from GitFlow to GitHub PR Workflow: A Journey in Streamlining Our Development Process Introduction In our company, we originally adopted the GitFlow model for our development workflow. This model served us well, facilitating a structured approach to feature development, release management, and hotfixes. However, with the introduction of GitHub and its powerful pull request (PR) workflow, we decided to transition to a more integrated system. This blog post outlines our journey, the challenges we faced, and the solutions we implemented to streamline our development process.
...</p></div><footer class=entry-footer><span title='2024-07-02 00:00:00 +0000 UTC'>July 2, 2024</span>&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to Transitioning from GitFlow to GitHub PR Workflow: A Journey in Streamlining Our Development Process" href=https://yiwei.dev/posts/github-flow/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>非线性优化 - Ceres Solver</h2></header><div class=entry-content><p>我们考虑这个优化问题：
$$ \min_{\mathbf{x}} \quad \frac{1}{2} \sum_{i} \rho_i \left(||f_i (x_{i_1}, … ,x_{i_k})||^2\right) $$
$$ \text{s.t.} \quad l_j \le x_j \le u_j $$
这个问题又称为非线性最小二乘问题。
具体来说，我们寻找$x$的最小值，并且$x$满足了约束$l_j \le x_j \le u_j$，使得函数$\rho_i \left(||f_i (x_{i_1}, … ,x_{i_k})||^2\right)$的和最小。我们又把$\rho_i \left(||f_i (x_{i_1}, … ,x_{i_k})||^2\right)$称之为残差块（ResidualBlock），$f_i (x_{i_1}, … ,x_{i_k})$成为代价函数（CostFunction），且依赖于$x_i$。$x_i$称为参数块（ParameterBlock）。同时参数块受到了$l_i$和$u_i$的约束。
特别的这里的$\rho_i$称为损失函数（LossFunction），用于减少外值对解的影响。
特别的，当我们的$\rho_i = f(x) = x$且上下界都为无穷大时，我们的问题简化为:
$$ \min_{\mathbf{x}} \quad \frac{1}{2} \sum_{i} \left(||f_i (x_{i_1}, … ,x_{i_k})||^2\right) $$
一个最简单的例子 我们考虑优化一个函数：
$$ \frac{1}{2}(10-x)^2 $$
我们用Ceres Solver来求解这个问题。很显然，这里的代价函数是$f(x) = 10 - x$，$\rho$为 1，且$x$在实数域上没有约束。所以我们定义我们的代价函数
struct CostFunctor { template &lt;typename T> bool operator()(const T* const x, T* residual) const { residual[0] = 10.0 - x[0]; return true; } } 现在我们可以解决这个优化问题：
...</p></div><footer class=entry-footer><span title='2023-12-23 00:00:00 +0000 UTC'>December 23, 2023</span>&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to 非线性优化 - Ceres Solver" href=https://yiwei.dev/posts/%E9%9D%9E%E7%BA%BF%E6%80%A7%E4%BC%98%E5%8C%96---ceres-solver/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>单目视觉vSLAM</h2></header><div class=entry-content><p>Matlab 官方提供了完整的单目视觉 vSLAM 的 pipeline，https://www.mathworks.com/help/vision/ug/monocular-visual-simultaneous-localization-and-mapping.html。这里对 Matlab 的这边文章的关键点做一个笔记和讨论，具体的实现可以参考原文文档。
初始化数据集 Matlab 提供了imageDatastore类用于初始化图像存储集合，其接受一个图像的文件夹路径的参数。
imageFolder = [dataFolder,'rgbd_dataset_freiburg3_long_office_household/rgb/']; imds = imageDatastore(imageFolder); 初始化地图 在 SLAM 管线中，首先我们应该对相机进行标定，相机标定可以用Computer Vision 工具箱中的相机标定工具。如果预先知道了相机的内参，可以通过cameraIntrinsics类直接进行初始化。
% Create a cameraIntrinsics object to store the camera intrinsic parameters. % The intrinsics for the dataset can be found at the following page: % https://vision.in.tum.de/data/datasets/rgbd-dataset/file_formats % Note that the images in the dataset are already undistorted, hence there % is no need to specify the distortion coefficients. focalLength = [535.4, 539.2]; % in units of pixels principalPoint = [320.1, 247.6]; % in units of pixels imageSize = size(currI,[1 2]); % in units of pixels intrinsics = cameraIntrinsics(focalLength, principalPoint, imageSize); 在例子中使用的数据集已经提供了相机的标定参数，我们可以直接使用。注意，对于一般相机获取到的照片来说，我们应该进行照片的去畸变，Matlab 提供了去畸变函数undistortImage，具体用法如下
...</p></div><footer class=entry-footer><span title='2023-12-22 00:00:00 +0000 UTC'>December 22, 2023</span>&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to 单目视觉vSLAM" href=https://yiwei.dev/posts/%E5%8D%95%E6%95%B0%E8%A7%86%E8%A7%89vslam/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>基于TinyTex的中文本地Tex环境</h2></header><div class=entry-content><p>在TinyTex之前，我已经换过无数个排版工具。从最开始的Word，到Pages，再到基于Markdown开发的MWeb和Ulysses。我很喜欢Ulysses，因为他既支持Markdown，又通过MathJax支持了LaTex语法。但是Markdown的排版能力还是非常有限的，尤其是theorem库的缺乏，Markdown只能作为一个快速笔记软件使用。
后来，我一直在使用Overleaf，不得不说Overleaf是一个非常不错的项目，至今市面上都没有更好的替代品。这也导致Overleaf的价格非常高，甚至学生价格都很高。作为一个研究生和普通的程序员的低频用户，肯定无法为这么高昂的价格付费。而单单免费版本，则又缺乏了类似GitHub同步之类的功能。之所以使用LaTex排版而不是Word，最大原因之一就是LaTex对Git优化，连Git都无法用了，Overleaf实在没有更多吸引我的地方。
之后，我同样使用了一些第三方的LaTex环境。比如在macOS上很好用的Texifier。Texifier这个项目不得不说也是花了很多心思，但可以看得出团队的预算不足，很多地方存在设计的瑕疵和开发的Bug。而且作为一款编辑器来说，他实在算不上功能强大。只不过在LaTex的开箱即用上面，至少做到了顺手。
我还使用了MacTex（或者是Tex Live）+ VScode + LaTex Workshop，从易用性到编辑器的熟悉程度以及到各种细节小问题的处理上，这一套方案基本是最佳方案，唯一的遗憾是庞大的MacTex和墙内的渣网速。在调研搜索过程中，看到了TinyTex这个发行版，TinyTex又有R语言的R Markdown背书，从文件大小到稳定性基本都满足了一个基本的Tex排版要求。
1. 下载TinyTex二进制发行版 TinyTex的发行版可以直接从GitHub, https://github.com/rstudio/tinytex-releases下载获得。我下载的是TinyTeX版本，TinyTeX-2的体积过于庞大，TinyTeX-1和TinyTeX-0的预置package又太少。
下载完成后解压缩放到任意文件夹下，并且将bin目录添加到PATH变量中。我是用的是macOS，因此我的PATH为
export PATH=$PATH:$HOME/TinyTeX/bin/universal-darwin 2. 更新tlmgr源和安装中文支持 设置好环境变量后，重启终端就可以访问tlmgr。为了在国内更快的访问速度，可以修改tlmgr源为清华源，执行
tlmgr option repository https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/tlnet 然后安装ctex包获得中文支持
tlmgr install ctex 3. 安装VScode + LaTex Workshop 在VScode中安装LaTex Workshop插件，安装成功后打开任意tex文件就可以愉快的书写啦。
对于中文支持，可以使用CJKutf8
\documentclass{article} \usepackage{CJKutf8} \begin{document} \begin{CJK*}{UTF8}{gbsn} \section{前言} \section{关于数学部分} 数学、中英文皆可以混排。You can intersperse math, Chinese and English (Latin script) without adding extra environments. \end{CJK*} \bigskip %% Just some white space You can also insert Latin text in your document \bigskip %% Just some white space \begin{CJK*}{UTF8}{bsmi} 這是繁體中文。 \end{CJK*} \end{document} 进行中英文混排。
...</p></div><footer class=entry-footer><span title='2023-11-16 00:00:00 +0000 UTC'>November 16, 2023</span>&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to 基于TinyTex的中文本地Tex环境" href=https://yiwei.dev/posts/%E5%9F%BA%E4%BA%8Etinytex%E7%9A%84%E4%B8%AD%E6%96%87%E6%9C%AC%E5%9C%B0tex%E7%8E%AF%E5%A2%83/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>渲染方程中的路径积分</h2></header><div class=entry-content><p>路径追踪是第一个光线传输算法，并广泛应用于Realistic Rendering中。路径追踪将渲染方程的积分式转换成一个路径积分的形式，并且通过蒙特卡洛积分方法对每一项进行积分，从而得到一个统计上无偏的渲染结果。因为路径积分的无偏属性，路径积分也常常被用作为渲染的Ground Truth，用于对比其他的渲染方法。
渲染方程 要完全推导路径积分并且用代码表示路径积分的计算过程，我们需要从渲染方程入手。
首先需要明确的一点是，渲染的目标是计算最终进入眼睛（摄像机）的辐射亮度（Radiance），即单位面积，单位立体角上的光通量（辐射功率）。另外一个重要的概念是辐射照度，辐照度（Irradiance），即单位面积上光通量（辐射功率）。根据几何光学的线性假设，当光射到物体表面产生反射的时候，其反射方向的辐射亮度的微分，和入射方向上辐射照度的微分成线性关系。这两者比例常数由入射角$\omega_i$和反射角$\omega_o$和物体表面属性直接给出，我们把这个函数称之为BRDF（双向反射分布函数），$f(p, \omega_i, \omega_o)$。双向反射分布函数理解起来比较具有挑战性，一个简单的方法是将其辐照度和辐亮度类比为连续型概率的中的随机变量和累积概率函数，那么累积概率函数和随机变量的微分比值，即BRDF，就是概率密度函数。
$$dL_o(p, \omega_o) = dE(p, \omega_i) = f(p, \omega_i, \omega_o)L_i(p, \omega_i)cos\theta_id\omega_i$$ 有了BRDF函数，我们就建立起了，对于物体表面上的一个点，点$p$，其反射的辐射亮度$L_o(p, \omega_o)$和入射的辐射亮度之间的关系，进一步的，如果我们考虑$p$上的自发光的辐射亮度$L_e(p, \omega_o)$，那我我们就可以建立起渲染方程
$$L_o(p, \omega_o) = L_e(p, \omega_o) + \int f(p, \omega_i, \omega_o)L_i(p, \omega_i)cos\theta_id\omega_i$$ 如果我们只考虑不透明反射模型，而不考虑更复杂的折射和次表面反射，那么我们的积分范围即是围绕表面法线的半球积分。
方向积分形式和面积积分形式 从渲染方程中，对于$L_e$项是相对简单的，我们可以从物体表面材质定义获得。对于积分项，我们则需要知道每个方向的$L_i$。首先需要明确一点，在真空环境中，光在传播过程中，辐射亮度并不发生变化。对于$L_i$项来说，其就等于它来自方向的点$p’$的反射的辐射亮度。为了更好的表示这一点，我们用函数$t(p, w_i) = p’$表示。函数$t$指的是，从$p$点出发，沿着$w_i$方向，第一个相交的点，即为$p’$。由此，渲染方程可以改写为
$$L_o(p, \omega_o) = L_e(p, \omega_o) + \int f(p, \omega_i, \omega_o)L_o(t(p, \omega_i), \omega_i')cos\theta_id\omega_i$$ 然而我们无法显式定义函数$t$，于是上面这个式子就无法显式定义，对于上面函数的展开，则必然包含着一个关于函数$t$的递归项无法消除。这使得我们仅仅可能通过递归黎曼求和的形式得到积分结果，而无法使用诸如蒙特卡洛近似的方式进行数值上的快速拟合。
为了显式改写该函数，我们重新定义一些记号，用于方更方便阅读。
首先是反射的辐射量度和入射的辐射亮度。在光线传输过程中提到，对于真空来说，辐射亮度在传输过程中不发生变化。那么对于一个点的入射辐射亮度，即是其来自方向反射（或者自发光）的辐射亮度。于是我们是用$L(p_1, p_0)$记号替代$L_i$和$L_o$，其表示点$p_1$到点$p_0$的辐射亮度。
同样的，BRDF方程记号我们也可以做相应的变化，我们使用$f(p_2, p_1, p_0)$表示从点$p_2$出发，击中表面点$p_1$，发生反射到达$p_0$的光路的BRDF。显然，该表达方式蕴涵了之前的立体角，从而在数学上是等价的。
经过上面两次记号的变化，在表达式上我们已经消除了立体角$\omega$的存在，然而微分项$d\omega_i$依然存在，我们需要将该微分项同样转换为关于点的表达式。由于
$$\omega = \frac{Acos\theta'}{d^2}$$ 我们便将立体角的微分转换为对应顶点处的面积微分，为此，我们引入一个函数
$$G(p_0, p_1) = V(p_0, p_1)\frac{|cos\theta_0||cos\theta_1|}{||p_0-p_1||^2}$$ 其中函数$V(p_0, p_1)$为可见性函数，如果两个点相互可见，则$V=1$，否则$V=0$。
于是渲染方程可以改写为
...</p></div><footer class=entry-footer><span title='2023-10-16 00:00:00 +0000 UTC'>October 16, 2023</span>&nbsp;·&nbsp;Yiwei Gong</footer><a class=entry-link aria-label="post link to 渲染方程中的路径积分" href=https://yiwei.dev/posts/%E6%B8%B2%E6%9F%93%E6%96%B9%E7%A8%8B%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84%E7%A7%AF%E5%88%86/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://yiwei.dev/posts/page/2/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://yiwei.dev/>禅心剑气相思骨</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>